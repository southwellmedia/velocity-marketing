---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { formatDate } from '@/lib/utils';

interface Props {
  title: string;
  description: string;
  href: string;
  publishedAt: Date;
  tags?: string[];
  featured?: boolean;
  author?: string;
  image?: ImageMetadata;
}

const {
  title,
  description,
  href,
  publishedAt,
  tags = [],
  featured = false,
  author,
  image,
} = Astro.props;

// Estimate reading time (rough estimate based on average words)
const wordsPerMinute = 200;
const estimatedWords = description.split(' ').length * 10; // Rough estimate
const readingTime = Math.max(1, Math.ceil(estimatedWords / wordsPerMinute));
---

<article
  class:list={[
    'group relative rounded-lg border bg-background p-6 transition-all duration-200 ease-out',
    featured
      ? 'border-brand-500/30 ring-1 ring-brand-500/20 shadow-lg'
      : 'border-border hover:-translate-y-0.5 hover:shadow-md hover:border-border-strong',
  ]}
>
  {featured && (
    <div class="absolute -top-3 left-4">
      <span class="inline-flex items-center gap-1 rounded-full bg-brand-500 px-3 py-1 text-xs font-semibold text-white shadow-sm">
        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
        Featured
      </span>
    </div>
  )}

  <a href={href} class="block">
    {image && (
      <div class="mb-4 overflow-hidden rounded-md">
        <Image
          src={image}
          alt={title}
          widths={[320, 640, 960]}
          sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 400px"
          class="aspect-video w-full object-cover transition-transform duration-300 group-hover:scale-105"
          loading="lazy"
        />
      </div>
    )}

    <h2 class="font-display text-xl font-bold text-foreground transition-colors group-hover:text-brand-600 dark:group-hover:text-brand-400 mb-2">
      {title}
    </h2>

    <p class="text-foreground-muted line-clamp-2 mb-4">
      {description}
    </p>

    <div class="flex flex-wrap items-center gap-3 text-sm text-foreground-subtle">
      {author && (
        <div class="flex items-center gap-2">
          <div class="h-6 w-6 rounded-full bg-brand-100 dark:bg-brand-900/30 flex items-center justify-center text-xs font-bold text-brand-600 dark:text-brand-400">
            {author.charAt(0).toUpperCase()}
          </div>
          <span class="font-medium">{author}</span>
        </div>
      )}

      <time datetime={publishedAt.toISOString()} class="flex items-center gap-1">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
        </svg>
        {formatDate(publishedAt)}
      </time>

      <span class="flex items-center gap-1">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        {readingTime} min read
      </span>
    </div>

    {tags.length > 0 && (
      <div class="mt-4 flex flex-wrap gap-2">
        {tags.slice(0, 3).map((tag) => (
          <span class="inline-flex items-center rounded-full bg-background-secondary px-2.5 py-0.5 text-xs font-medium text-foreground-muted ring-1 ring-inset ring-border transition-colors group-hover:bg-brand-50 group-hover:text-brand-700 group-hover:ring-brand-200 dark:group-hover:bg-brand-900/20 dark:group-hover:text-brand-400 dark:group-hover:ring-brand-800">
            {tag}
          </span>
        ))}
        {tags.length > 3 && (
          <span class="text-xs text-foreground-subtle">+{tags.length - 3}</span>
        )}
      </div>
    )}
  </a>
</article>
